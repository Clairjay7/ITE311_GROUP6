# Disable directory browsing
Options -Indexes

<IfModule mod_rewrite.c>
    RewriteEngine On
    
    # Deny direct access to sensitive folders
    RewriteCond %{REQUEST_URI} (app|system|writable|tests)/
    RewriteRule ^ - [F]
    
    # Block direct access to /public - return 404 (Page Not Found)
    # This MUST be before the internal rewrite rule below
    # Catches: /group6/public, /group6/public/, /group6/public/anything
    # Case-insensitive to handle Group6 vs group6
    RewriteCond %{REQUEST_URI} /public [NC]
    RewriteRule ^(.*)/public(/.*)?$ - [R=404,L]
    
    # Skip rewrite if file or directory exists in root
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    
    # Redirect everything else to public folder (internal rewrite, no redirect)
    RewriteRule ^(.*)$ public/$1 [L]
</IfModule>

# Deny access to .env file
<Files ".env">
    <IfModule mod_authz_core.c>
        Require all denied
    </IfModule>
    <IfModule !mod_authz_core.c>
        Order allow,deny
        Deny from all
    </IfModule>
</Files>

# Deny access to sensitive files
<FilesMatch "^(composer\.(json|lock)|package\.json|package-lock\.json|\.gitignore|README\.md|spark)$">
    <IfModule mod_authz_core.c>
        Require all denied
    </IfModule>
    <IfModule !mod_authz_core.c>
        Order allow,deny
        Deny from all
    </IfModule>
</FilesMatch>
